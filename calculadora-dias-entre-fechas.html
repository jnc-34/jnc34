<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora de días entre fechas</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f6fbff; --card:#ffffff; --muted:#6b7280; --text:#0f172a; --accent:#0b76f4; --accent-2:#0ea5a4; --border:#e6eef9;
    }
    body{font-family:'Montserrat',system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--text); margin:18px}
    .container{max-width:900px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(11,118,244,0.04);}
    h1{font-size:1.3rem;margin-bottom:8px}
    label{display:block;margin-top:8px;font-weight:600}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    input,select,button{padding:10px;border-radius:8px;border:1px solid #e9f1ff;font-size:0.95rem;background:#fff}
    .small{font-size:0.9rem;color:var(--muted)}
    .result{background:linear-gradient(180deg,#fff 0%,#f7fbff 100%);padding:12px;border-radius:10px;margin-top:12px;border:1px solid var(--border)}
    .trace{margin-top:10px;background:#fff;padding:12px;border-radius:8px;border:1px solid var(--border)}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(11,118,244,0.12)}
    .flex{display:flex;gap:10px;align-items:center}
    @media(max-width:720px){.row{flex-direction:column}.flex{flex-direction:column;align-items:flex-start}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Calculadora de días entre fechas</h1>
      <p class="small">Indica la fecha de inicio y la fecha de fin. Elige si incluir/excluir los extremos y si contar días hábiles o corridos.</p>

      <label>Fecha inicio</label>
      <div class="row">
        <input id="s_dia" placeholder="DD" maxlength="2" style="width:86px" />
        <input id="s_mes" placeholder="MM" maxlength="2" style="width:86px" />
        <input id="s_anio" placeholder="AAAA" maxlength="4" style="width:118px" />
      </div>

      <label>Fecha fin</label>
      <div class="row">
        <input id="e_dia" placeholder="DD" maxlength="2" style="width:86px" />
        <input id="e_mes" placeholder="MM" maxlength="2" style="width:86px" />
        <input id="e_anio" placeholder="AAAA" maxlength="4" style="width:118px" />
      </div>

      <div class="row" style="margin-top:8px;align-items:center">
        <div>
          <label class="small">Incluir / Excluir extremos</label>
          <div class="flex">
            <label><input type="checkbox" id="includeStart" checked /> Incluir inicio</label>
            <label style="margin-left:10px"><input type="checkbox" id="includeEnd" checked /> Incluir fin</label>
          </div>
        </div>

        <div style="margin-left:20px">
          <label class="small">Tipo de conteo</label>
          <div class="flex">
            <label><input type="radio" name="tipo" value="corridos" checked /> Días corridos</label>
            <label style="margin-left:10px"><input type="radio" name="tipo" value="habiles" /> Días hábiles</label>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <button id="calc">Calcular</button>
        <button id="reset" class="ghost" style="margin-left:8px">Limpiar</button>
        <button id="force" class="ghost" style="margin-left:8px">Forzar recarga (cache)</button>
      </div>

      <p class="small" style="margin-top:10px">Años soportados: <span id="yearsRange"></span></p>

      <div id="output" class="result" style="display:none">
        <div id="summary"></div>
        <div id="details" style="margin-top:8px"></div>
      </div>

      <div id="trace" class="trace" style="display:none"></div>
    </div>
  </div>

<script>
// === funciones utilitarias ===
const API_BASE = 'https://api.argentinadatos.com/v1/feriados';
const MIN_YEAR = 2021; let MAX_YEAR = new Date().getFullYear(); if (MAX_YEAR < 2025) MAX_YEAR = 2025;

function toYmd(d){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`}
function parseYmd(str){const [y,m,day]=str.split('-').map(Number);return new Date(y,m-1,day)}
function addDays(d,n){const x=new Date(d);x.setDate(x.getDate()+n);return x}
function isWeekend(date){const d=date.getDay();return d===0||d===6}

function thirdMondayOfJuly(year){const d=new Date(year,6,1);while(d.getDay()!==1) d.setDate(d.getDate()+1);return addDays(d,14)}
function customInhabilesForYear(year){const res=new Map();for(let day=1;day<=31;day++){const d=new Date(year,0,day);res.set(toYmd(d),'Feria de enero')}const nov16=new Date(year,10,16);res.set(toYmd(nov16),'16 de noviembre (ley local)');const thirdMon=thirdMondayOfJuly(year);for(let i=1;i<=14;i++){res.set(toYmd(addDays(thirdMon,i)),'Feria de julio')}return res}

async function fetchFeriados(year){try{const res=await fetch(`${API_BASE}/${year}`);if(!res.ok) throw new Error('API feriados no disponible');const data=await res.json();const m=new Map();data.forEach(f=>{if(f.fecha) m.set(f.fecha,f.nombre||f.tipo||'Feriado')});return m}catch(e){console.warn('API feriados falló',e);return new Map()}}

async function tryFetch(url){try{const res=await fetch(url,{cache:'no-store'});if(res.ok){return {ok:true,data:await res.json(),url}}else{return {ok:false,status:res.status,url}}}catch(e){return {ok:false,error:e,url}}}
async function fetchCustomOverrides(){const cb='_='+Date.now();const candidates=['./
